const oficinasMap = {
"0001":"MXN","0002":"PCH","0003":"ACT","0004":"IXM","0005":"HUI","0007":"TEC","0008":"SJR","0010":"QRO",
"0013":"CEL","0015":"ACA","0016":"SCA","0017":"SLD","0019":"IRA","0020":"MRN","0022":"TAM","0023":"SIL",
"0024":"MOR","0025":"GTO","0026":"SVT","0027":"ZIT","0028":"LEO","0029":"PIE","0030":"SLP","0031":"LMO",
"0032":"CDV","0033":"EDD","0034":"SJL","0036":"OJU","0037":"SLS","0038":"AGS","0043":"TPE","0045":"MNT",
"0046":"RDR","0048":"GDA","0049":"LMY","0050":"OJC","0051":"ZAC","0052":"MTH","0055":"AME","0057":"FRE",
"0058":"TPO","0059":"IXT","0061":"RGR","0063":"CVI","0064":"SOM","0065":"NDH","0066":"ALD","0068":"TEP",
"0069":"VGR","0070":"NDS","0071":"LIN","0072":"CPT","0073":"SAL","0074":"CUY","0075":"PQT","0076":"CAL",
"0077":"DGO","0078":"SNF","0079":"LUC","0081":"CAN","0082":"MTY","0083":"ZAM","0084":"GOM","0085":"TOR",
"0086":"SLT","0087":"VTA","0090":"NID","0091":"SMD","0092":"LCD","0093":"SHG","0094":"ROD","0095":"SPA",
"0096":"MAT","0097":"FRM","0098":"PTX","0099":"REY","0101":"GPV","0102":"MAZ","0103":"VUL","0110":"LAR",
"0111":"EJD","0112":"NIE","0113":"PRR","0114":"JIM","0115":"CAM","0116":"DEL","0117":"CMQ","0118":"CHI",
"0119":"ZZA","0120":"VAH","0121":"JUA","0124":"RBV","0125":"ABT","0126":"COS","0128":"EMN","0130":"AYG",
"0135":"CDM","0136":"ENA","0141":"ANM","0143":"SZZ","0144":"SCL","0150":"NAP","0153":"ARA","0155":"TEO",
"0156":"NOC","0157":"TGO","0161":"HHG","0162":"NEC","0163":"XIC","0164":"VMA","0165":"ZXT","0166":"AND",
"0167":"VLC","0169":"POZ","0170":"TIH","0171":"ALA","0172":"TUX","0175":"CRY","0177":"POT","0178":"CEA",
"0179":"TZL","0180":"NAR","0181":"CAR","0183":"SEB","0184":"TTY","0185":"OZU","0186":"CHT","0187":"PSA",
"0189":"HJT","0190":"TEM","0194":"HIG","0197":"PAN","0200":"SAI","0205":"VAM","0207":"JAU","0209":"PAU",
"0211":"SLM","0213":"JPN","0214":"TUL","0215":"RVE","0220":"TOL","0228":"SBH","0231":"PAH","0232":"NPL",
"0233":"MAV","0234":"JTC","0235":"CHA","0236":"CER","0237":"XIL","0238":"TPH","0240":"LGR","0242":"DZA",
"0245":"TML","0248":"COR","0249":"TTP","0250":"HJC","0251":"MOE","0254":"TLT","0255":"THF","0256":"TEU",
"0258":"VGU","0259":"BOL","0260":"SNM","0261":"VAR","0266":"TTU","0267":"MEQ","0271":"VCS","0277":"APN",
"0281":"ATU","0283":"VLP","0284":"HJU","0285":"JER","0286":"CLT","0293":"YER","0299":"JAG","0302":"YEC",
"0304":"C72","0307":"JNC","0310":"PED","0313":"VAN","0315":"PUE","0316":"VLA","0318":"DOL","0319":"SMA",
"0323":"ZTX","0325":"ZAU","0328":"OLG","0332":"SFO","0333":"SAM","0336":"ZAT","0337":"MMS","0338":"HUA",
"0340":"ALL","0342":"BRQ","0343":"CWS","0345":"MJH","0347":"CEN","0350":"CPA","0351":"CGD","0352":"BVN",
"0353":"RFM","0354":"USC","0355":"COY","0356":"OJI","0359":"ACU","0363":"IDG","0366":"CGR","0367":"CMA",
"0369":"FRT","0370":"MLU","0371":"TER","0373":"JIZ","0376":"MON","0381":"INA","0385":"NAA","0386":"NVR",
"0391":"LJU","0394":"PDN","0395":"SAB","0396":"JAN","0399":"SNB","0411":"AOT","0413":"NCC","0414":"GCR",
"0419":"LNX","0422":"ATS","0425":"TLN","0427":"AHZ","0428":"AGB","0432":"CNS","0435":"EWC","0436":"CNE",
"0442":"HTS","0446":"BON","0469":"JOA","0482":"ZAP","0485":"RAM","0486":"SPC","0487":"ANI","0490":"MPP",
"0491":"TIO","0499":"FIM","0501":"TAA","0521":"OTO","0524":"MOV","0540":"HER","0547":"UTL","0548":"CMC",
"0549":"IMS","0550":"ABA","0585":"VIJ","0603":"SAU","0606":"SUZ","0613":"LYH","0615":"AHC","0640":"LUD",
"0643":"VHI","0645":"GPU","0655":"EHU","0658":"XOL","0659":"SJD","0673":"SJN","0674":"CRL","0682":"CEY",
"0686":"BOC","0687":"ZOO","0691":"TMJ","0697":"STO","0698":"MTC","0699":"TMS","0703":"VZA","0705":"ACA",
"0706":"BAS","0707":"EMA","0713":"ARC","0715":"AYU","0716":"CHL","0717":"CHG","0720":"CUA","0721":"CUE",
"0722":"CUA","0723":"IGU","0724":"JAM","0726":"LAZ","0727":"MRQ","0728":"OME","0729":"PET","0730":"PNL",
"0732":"PES","0733":"RGD","0734":"TAX","0736":"TEL","0737":"TCO","0741":"ZIH","0745":"TLP","0746":"HUE",
"0759":"SLC","0760":"HTC","0761":"SRL","0763":"TCP","0764":"LME","0765":"ALT","0777":"SMR","0783":"COP",
"0784":"XGR","0788":"POC","0805":"INV","0834":"JCH","0839":"CRC","0847":"CAH","0850":"LLL","0853":"OBR",
"0854":"CHV","0872":"YTX","1018":"PNO","1021":"NIT","1022":"SHY","1027":"URU","1030":"TZG","1034":"CGZ",
"1035":"OTL","1036":"MLQ","1037":"TCM","1039":"COL","1040":"MZN","1042":"LBR","1043":"FPE","1044":"SIX",
"1045":"RUZ","1046":"CUL","1047":"GUA","1048":"MOC","1050":"JLA","1051":"TWX","1053":"GUS","1054":"VHH",
"1055":"APT","1056":"BEN","1057":"CAB","1058":"CNN","1059":"EMP","1060":"GMS","1061":"HAO","1062":"MAA",
"1063":"IMU","1064":"NAC","1065":"NAV","1066":"NOG","1067":"STA","1068":"SON","1069":"SLR","1070":"ENS",
"1071":"MXI","1072":"TTE","1073":"TIJ","1075":"DEN","1085":"LNS","1086":"AFT","1094":"VIA","1109":"PJD",
"1113":"APS","1115":"APR","1136":"AVP","1141":"MXP","1151":"PWJ","1158":"VEM","1162":"ABV","1163":"AVA",
"1190":"BBR","1196":"CTG","1198":"PPE","1235":"APV","1241":"GAT","1252":"BUC","1267":"VUN","1278":"KNT",
"1282":"VGS","1324":"CWH","1326":"AGP","1336":"CLA","1339":"XPO","1363":"PZA","1393":"XGB","1394":"GCH",
"1418":"CFQ","1421":"ARI","1437":"ASB","1438":"TMY","1439":"NGG","1470":"MHU","1476":"EOO","1498":"RAB",
"1499":"TCU","1506":"XGF","1513":"AFC","1518":"XUR","1519":"XCN","1522":"XIZ","1532":"XDC","1545":"XAR",
"1550":"YDC","1573":"NOA","1588":"LRD","1616":"XTE","1617":"ALU","1625":"XGZ","1643":"VRM","1650":"ACN",
"1656":"GLN","1674":"LBM","1676":"SRE","1677":"XWT","1722":"SLN","1822":"MCS","1845":"UAF","1853":"MBS",
"1878":"OXD","1981":"SYZ","1993":"CWL","1995":"MTW","2200":"IXZ","2202":"GCT","2224":"CFX","2231":"NLI",
"2235":"RTM","2237":"GSS","2242":"MSI","2243":"RYT","2248":"JSV","2250":"TSV","2259":"SYE","2260":"SYR",
"2262":"SGK","2269":"BGK","2270":"SGN","2274":"LGW","2277":"DGV","2279":"FGN","2287":"EGS","2291":"TGU",
"2298":"UGB","2306":"FRR","2332":"DHD","2345":"LXA","2358":"PZX","2379":"AQQ","2398":"OTP","2408":"RCX",
"2430":"GEV","2431":"MLZ","2473":"CLX","3025":"TBK","3069":"WGC","3101":"ECX","3103":"ZLT","3189":"CHD",
"3190":"CUF","3191":"CTF","3193":"QUN","3203":"MHA","3207":"MHY","3210":"AQT","3270":"WEM","3271":"WCR",
"3272":"WLR","3273":"SWV","3277":"WNG","3306":"AZW","3307":"WZS","3319":"XSZ","3321":"WBN","3322":"QWN",
"3323":"WQN","3324":"WLC","3325":"QSN","3326":"NWS","3327":"AWP","3330":"WST","3334":"FCF","3336":"WZT",
"3338":"WXZ","3340":"WWG","3341":"WXH","3348":"ZMH","3349":"XXX","3352":"HXU","3369":"QWB","3377":"QWA",
"3378":"ZWQ","3379":"WZM","3380":"WPQ","3381":"BLV","3386":"HBC","3387":"WQP","3388":"RIB","3389":"OHL",
"3390":"TSA","3396":"XMO","3398":"WSH","3402":"NZC","3404":"ZWA","3412":"LWN","3414":"SZR","3415":"VWO",
"3416":"OWA","3417":"YWR","3418":"ZMA","3419":"BTI","3420":"TJW","3421":"MHZ","3422":"GNC","3423":"NUV",
"3424":"RCW","3427":"BMJ","3428":"VWQ","3431":"DZM","3432":"DBI","3433":"BIQ","3434":"S2C","3435":"ZMI",
"3436":"HWP","3439":"FFB","3440":"QAW","3441":"IOS","3442":"OPB","3443":"TUY","3445":"YAC","3446":"HWJ",
"3447":"TKW","3448":"TLZ","3450":"TLY","3451":"AYX","3452":"DIT","3453":"BAV","3454":"NCV","3455":"WXG",
"3456":"ZZC","3457":"BSD","3458":"WXO","3459":"HMB","3460":"GHB","3461":"KWO","3462":"GKL","3463":"YWB",
"3464":"HYC","3465":"MYL","3466":"NYM","3467":"RHY","3468":"BTY","3469":"LRB","3470":"PUL","3472":"NWV",
"3474":"ASX","3475":"THG","3477":"YMX","3479":"ERS","3480":"TVX","3481":"NXT","3482":"SWC","3483":"VTW",
"3485":"OWN","3488":"SYT","3489":"WNS","3490":"WPJ","3491":"YYT","3492":"TWO","3493":"XSJ","3494":"SBP",
"3495":"HMG","3496":"SDM","3497":"ZMS","3498":"ZML","3499":"SMZ","3500":"WXD","3501":"LXW","3502":"SBF",
"3503":"ZMD","3504":"ABU","3505":"GEL","3506":"ZEO","3507":"DIN","3508":"ZGA","3509":"HMU","3510":"JCJ",
"3511":"VPC","3512":"EMI","3513":"QAC","3514":"QAB","3515":"QAE","3516":"YPU","3517":"YCE","3518":"JOE",
"3519":"CSE","3520":"EXW","3522":"QAA","3523":"WBI","3524":"QET","3525":"ROW","3526":"HOW","3527":"EWA",
"3528":"AED","3530":"ATW","3531":"ACW","3532":"WRT","3533":"XPA","3534":"WEF","3535":"TCH","3536":"WEA",
"3537":"WEE","3538":"WBU","3539":"WFU","3540":"WFO","3541":"JIT","3542":"WOP","3548":"LNN","3551":"TLV",
"3552":"ZMG","3553":"WAH","3554":"WSE","3555":"WEL","3556":"WGB","3557":"SDP","3558":"SCU","3559":"SHU",
"3560":"SDV","3561":"SPX","3562":"SOE","3563":"SDL","3564":"SDJ","3565":"MYS","3566":"HGZ","3567":"HZG",
"3568":"ZGH","3570":"CGM","3571":"SHR","3572":"SHA","3573":"SHJ","3574":"SNP","3575":"SHD","3576":"SHS",
"3578":"VBS","3579":"LTH","3580":"SNY","3581":"RVM","3582":"CEV","3583":"LYO","3584":"SIP","3585":"GSN",
"3586":"ZMP","3587":"GCM","3590":"ZMM","3591":"HYL","3592":"RSH","3593":"MSJ","3594":"IFA","3595":"DCC",
"3596":"OTB","3597":"ZSN","3598":"CIL","3599":"FDO","3600":"BUD","3601":"RDB","3602":"SDH","3603":"DSH",
"3604":"IVT","3605":"IBC","3606":"MRU","3608":"EDL","3609":"TOB","3611":"BPP","3612":"OAD","3613":"GZO",
"3614":"HGM","3615":"HRM","3616":"OPN","3617":"YDO","3618":"ZLI","3619":"JHS","3620":"JUY","3621":"VFD",
"3622":"OPO","3623":"KJN","3624":"BCG","3625":"ATC","3626":"BHJ","3627":"EFZ","3628":"OIF","3629":"QQE",
"3630":"WAR","3631":"FKG","3632":"YSH","3633":"HYJ","3634":"KFO","3635":"TVS","3636":"HLC","3640":"LRU",
"3641":"DIM","3642":"FLK","3643":"GEO","3644":"PQE","3648":"JDH","3649":"NNR","3650":"BJX","3651":"BSG",
"3652":"TSO","3653":"NBJ","3654":"BJQ","3655":"BVJ","3656":"TEB","3657":"UNA","3658":"BJI","3659":"BPC",
"3660":"JCR","3661":"NPR","3662":"BJP","3663":"BSJ","3664":"NCS","3665":"NAP","3666":"JHU","3667":"LTN",
"3668":"NSR","3669":"NGR","3670":"NML","3671":"NDR","3672":"NPZ","3673":"NGI","3674":"NVZ","3675":"TDN",
"3676":"NPX","3677":"DBR","3678":"NAW","3679":"NCX","3680":"NSM","3681":"MNX","3682":"JXN","3684":"PAN",
"3685":"EGX","3686":"SCN","3687":"JNF","3688":"DAQ","3689":"RLM","3690":"VEB","3694":"SFD","3695":"JFK",
"3696":"QQK","3697":"ZVS","3698":"JSD","3700":"HBA","3701":"DVF","3702":"FGS","3703":"FDF","3704":"WSF",
"3705":"DFA","3706":"NFS","3707":"NBY","3708":"JBD","3709":"LYJ","3710":"KFD","3691":"VEÑ",
"3711":"FGI","3712":"WEV","3713":"LGF","3714":"FVG","3715":"NJG","3716":"GRK","3717":"KRG","3718":"FEK",
"3719":"MGV","3720":"HGH","3721":"LFJ","3722":"GHG","3723":"EFN","3724":"LFI","3726":"GFM","3727":"BHS",
"3728":"RTE","3729":"DSR","3730":"JDE","3731":"FDR","3732":"JYF","3733":"FGB","3734":"MIX","3735":"CCX",
"3736":"JXX","3737":"DSX","3738":"OHX","3739":"VXX","3740":"UUX","3741":"IMX","3742":"XBS","3743":"QLX",
"3744":"EXR","3746":"GFV","3747":"JIJ","3748":"PYH","3749":"IOP","3751":"JNG","3752":"GTE","3753":"NMV",
"3754":"MNF","3755":"KGB","3756":"HJY","3759":"JDO","3761":"NFW","3762":"GEA","3764":"NHN","3765":"DTV",
"3766":"KIK","3767":"BOD","3768":"CWD","3769":"PDW","3770":"CJE","3771":"LKF","3772":"CYV","3773":"PUW",
"3774":"EVY","3776":"VSR","3777":"HJX","3779":"BYH","3780":"EDP","3783":"GDW","3784":"WHY","3789":"NSH",
"3790":"LWX","3791":"PFE","3792":"TZK","3793":"PDZ","3794":"NJD","3795":"SKD","3799":"MCK","3800":"LMF",
"3801":"LMH","3802":"LMJ","3803":"LMK","3804":"LQM","3805":"LQW","3806":"LQE","3807":"LQY","3809":"LQU",
"3810":"LQI","3811":"LQO","3812":"LQP","3813":"LQA","3814":"SXS","3815":"AYS","3816":"CBM","3817":"LSF",
"3818":"LDW","3819":"LQH","3820":"LQJ","3821":"LQK","3822":"LQL","3823":"LQX","3824":"LQC","3825":"LQB",
"3826":"LQN","3827":"LWW","3828":"LWR","3829":"LWY","3830":"LWU","3831":"LWI","3832":"LWO","3833":"LWA",
"3834":"LWD","3835":"LWF","3836":"LWH","3837":"LWJ","3838":"LWL","3839":"LWZ","3840":"LWV","3841":"LWM",
"3842":"LEQ","3843":"LEW","3844":"LEU","3845":"LEI","3846":"LEP","3847":"LEK","3848":"LEZ","3849":"LEX",
"3850":"LEV","3851":"LEN","3852":"LEM","3853":"LRO","3854":"LRP","3855":"LRH","3856":"LRJ","3857":"LRM",
"3858":"LDQ","3859":"SWN","3860":"JDZ","3861":"AQW","3862":"HSA","3863":"GFE","3864":"KEA","3865":"KJS",
"3866":"NYE","3867":"LHD","3868":"SHB","3869":"DFV","3870":"BKA","3871":"JWS","3872":"SZD","3873":"LZE",
"3874":"LZU","3875":"LZD","3876":"LDU","3877":"LSY","3878":"LXF","3879":"SZG","3880":"GJD","3881":"EFO",
"3882":"MST","3883":"KSU","3884":"LDI","3885":"TDT","3886":"TSU","3887":"KDT","3888":"SQB","3890":"PCJ",
"3891":"PDF","3892":"TSH","3893":"KAV","3894":"AJF","3895":"NSO","3896":"GES","3897":"SYC","3898":"TSB",
"7434":"ML2","8013":"OMN","9004":"WIW","9005":"SSZ","9006":"FDD","1C":"MXS","1D":"UDD","1L":"DPS",
"1M":"DNT","1N":"DGF","1O":"DCN","1W":"WEB","48A":"GYS","48B":"GWB","B481":"ISM","C324":"C73","CLMX":"CLM",
"E003":"WAD","E277":"VNS","E278":"MZF","G384":"GYP","G397":"PHG","H021":"RVC","H031":"IND","H321":"AHL",
"H514":"LON","J103":"LOW","J105":"PNS","J109":"GEQ","J114":"SEG","J116":"SNH","J117":"ELI","J119":"TOD",
"J121":"ELG","J123":"TRD","J124":"SAN","J125":"SBU","J126":"BAO","J127":"BUA","J130":"SGV","J131":"MIO",
"J133":"LSQ","J134":"CEO","J136":"ZCE","J137":"KM0","J139":"KM8","J140":"RIA","J141":"VIR","J143":"LEF",
"J144":"RIE","J145":"LIF","J146":"JUI","J147":"NOL","J148":"KMN","J149":"KND","J150":"BHA","J151":"BMU",
"J152":"LLU","J153":"BRU","J154":"LQT","J155":"NRO","J156":"SIG","J157":"FSH","J158":"HAI","J159":"JEM",
"J160":"RDE","J161":"PNT","J162":"IES","J164":"SSQ","J166":"QTN","J167":"JLV","J168":"BPK","J169":"BTA",
"J170":"TFE","J171":"ZHL","J172":"BCT","J174":"VHT","J175":"BEZ","J176":"BCM","J178":"BCJ","J179":"RHB",
"J180":"BJR","J183":"BTE","J184":"BLD","J186":"BCH","J187":"DNA","J188":"BLG","J189":"BCU","J191":"ZLR",
"J192":"BSM","J193":"BMR","J194":"BLS","J195":"MXE","J196":"ZPB","J261":"LV0","J569":"XSX","N133":"BSN",
"N138":"MPJ","N207":"PRF","N357":"LRY","N373":"GGC","O031":"CPL","O043":"SFN","O096":"JTX","O138":"CR0",
"O141":"ELN","PR66":"RAH","Q213":"NDY","U059":"PHO","U060":"TUU","U070":"DEM","U075":"KIN","U076":"LVN",
"U077":"LNM","U078":"LDB","U108":"TGX","U157":"BTW","U182":"MML","U195":"CXT","U198":"RBX","U236":"UGR",
"U242":"UEA","U244":"MOD","U248":"USL","U253":"UMC","U254":"UTK","U255":"UMT","U259":"UAA","U278":"USF",
"U283":"UDO","U284":"UTE","U286":"UGN","U287":"UMR","U289":"USN","U291":"USM","U294":"UDN","U308":"UBH",
"U309":"UID","U313":"UWX","U315":"UFA","U389":"URT","U411":"UBX","U432":"UTY","U433":"UCZ","U435":"UHQ",
"U437":"UOS","U444":"UTN","U445":"UTI","U446":"UPB","U447":"USG","U459":"ULN","U463":"UWU","U464":"UEZ",
"U466":"UTF","U468":"UIS","U469":"ANC","U582":"BEE","U723":"EWX","U724":"OWX","U727":"BRW","U728":"FTW",
"U729":"PWX","U730":"GWW","U744":"EHO","U745":"MJN","U750":"HBF","U754":"AEW","U765":"BGO","U768":"BWO",
"U770":"LYW","V417":"MWQ","V619":"KLD","V621":"KAI","V623":"KFW","V627":"KAU","V628":"KDL","V631":"KHG",
"V633":"LII"
};

let resultados = [];

function pad7(num) {
  return num.toString().padStart(7,'0');
}

function generar() {
  const oficinas = document.getElementById('oficinas').value.trim().split('\n');
  const usuario = document.getElementById('usuario').value.trim();
  const puesto = document.getElementById('puesto').value;
  let out = '';
  resultados = [];
  const errores = [];

  if (!usuario || isNaN(usuario)) {
    alert("La clave de usuario debe ser numérica y no estar vacía");
    return;
  }

  // Filtrar duplicados
  const oficinasUnicas = [...new Set(oficinas.map(l => l.trim()))];

  oficinasUnicas.forEach(numero => {
    if (!numero) return;
    const abrev = oficinasMap[numero];
    if (!abrev) {
      errores.push(`Oficina ${numero} no encontrada.`);
      return;
    }
    const clave = `${abrev}${pad7(usuario)}`;
    out += `PUESTO: ${puesto} ${abrev} ${numero}\nOFICINA: ${numero}    ABREVIATURA: ${abrev}\nCLAVE: ${clave}\n\n`;
    resultados.push({Puesto: `${puesto} ${abrev} ${numero}`, Oficina: numero, Abreviatura: abrev, Clave: clave});
  });

  document.getElementById('resultado').innerText = out.trim();
  document.getElementById('errores').innerText = errores.join('\n');
}

function descargarExcel() {
  if (resultados.length === 0) return alert("Genera primero los datos");
  const ws = XLSX.utils.json_to_sheet(resultados);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Oficinas");
  XLSX.writeFile(wb, "Oficinas.xlsx");
}

function descargarWord() {
  if (resultados.length === 0) return alert("Genera primero los datos");
  let contenido = "<html><body>";
  contenido += "<h2>Resultado de Oficinas</h2>";
  contenido += "<table border='1' cellpadding='5' cellspacing='0'>";
  contenido += "<tr><th>Puesto</th><th>Oficina</th><th>Abreviatura</th><th>Clave</th></tr>";
  resultados.forEach(r => {
    contenido += `<tr><td>${r.Puesto}</td><td>${r.Oficina}</td><td>${r.Abreviatura}</td><td>${r.Clave}</td></tr>`;
  });
  contenido += "</table></body></html>";
  const blob = new Blob([contenido], {type: "application/msword"});
  saveAs(blob, "Oficinas.doc");
}